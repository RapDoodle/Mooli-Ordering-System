{% extends "/admin/shared/base.html" %}

{% block title %}Product{% endblock %}

{% block content %}
<div class="row">
	<div class="col" id="location">
		<span><a href="{{ url_for('admin_dashboard.dashboard') }}">Home</a> / Staff </span>
	</div>
</div>
<div class="row">
	<div class="col-9">
		<button class="btn btn-light" type="button" name="button" data-toggle="modal" data-target="#newModal"><i
				class="fa fa-plus"></i></button><br><br>
	</div>
</div>

<table class="table table-bordered table-striped table-hover">
	<tr>
		<th>User ID</th>
		<th>Username</th>
		<th>Email</th>
		<th>Name</th>
		<th>Role</th>
		<th>Phone</th>
		<th>Manage</th>
	</tr>
	{% for staff in staffs %}
	<tr>
		<td>{{ staff['user_id'] }}</td>
		<td>{{ staff['username'] }}</td>
		<td>{{ staff['email'] }}</td>
		<td>{{ staff['first_name'] }} {{ staff['last_name'] }}</td>
		<td>{{ staff['role_name'] }}</td>
		<td>{{ staff['phone'] }}</td>
		<td>
			<div class="dropdown">
				<button class="btn btn-light dropdown-toggle" type="button" id="maangeButton" data-toggle="dropdown"
					aria-haspopup="true" aria-expanded="false">
					<i class="fa fa-gear"></i>
				</button>
				<div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
					<a class="dropdown-item" href="#" data-toggle="modal" data-target="#editModal"
						data-staff-id="{{ staff['staff_id'] }}">Edit</a>
					<a class="dropdown-item" href="#" data-toggle="modal" data-target="#deleteModal"
						data-staff-id="{{ staff['staff_id'] }}">Delete</a>
				</div>
			</div>
		</td>
	</tr>
	{% endfor %}
</table>

<!-- Modal for adding new staff -->
<div class="modal fade" id="newModal" tabindex="-1" role="dialog" aria-labelledby="newModalLabel" aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="newModalLabel">New staff</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<form action="{{ url_for('admin_staff.new_staff') }}" method="post" id="add-form">
					<input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
					<div class="form-group">
						<label class="col-form-label">Username</label>
						<input type="text" class="form-control" id="new-username" name="username">
					</div>
					<div class="form-group">
						<label class="col-form-label">Email:</label>
						<input type="email" class="form-control" id="new-email" name="email">
					</div>
					<div class="form-group">
						<label class="col-form-label">Password:</label>
						<input type="password" class="form-control" id="new-password" name="password">
					</div>
					<div class="form-group">
						<label class="col-form-label">Role:</label>
						<select class="form-control" id="new-role" name="role_id">
							{% for role in roles %}
							<option value="{{ role['role_id'] }}">{{ role['role_name'] }}</option>
							{% endfor %}
						</select>
					</div>
					<div class="form-group">
						<label class="col-form-label">First name:</label>
						<input type="text" class="form-control" id="new-first-name" name="first_name">
					</div>
					<div class="form-group">
						<label class="col-form-label">Last name:</label>
						<input type="text" class="form-control" id="new-last-name" name="last_name">
					</div>
					<div class="form-group">
						<label class="col-form-label">Gender:</label>
						<select class="form-control" id="new-gender" name="gender">
							<option value='M'>Male</option>
							<option value='F'>Female</option>
						</select>
					</div>
					<div class="form-group">
						<label class="col-form-label">Phone:</label>
						<input type="text" class="form-control" id="new-phone" name="phone">
					</div>

				</form>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
				<button type="submit" class="btn btn-primary" form="add-form">Confirm</button>
			</div>
		</div>
	</div>
</div>

<!-- Modal for editing product info -->
<div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="editModalLabel" aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="newproductModalLabel">Edit product</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<form action="{{ url_for('admin_staff.edit_staff') }}" method="post" id="edit-form">
					<input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
					<input type="hidden" name="productID" id="edit-productID" value="" />
					<div class="form-group">
						<label for="product-name" class="col-form-label">Product name:</label>
						<input type="text" class="form-control" id="edit-productName" name="productName">
					</div>
					<div class="form-group">
						<label for="product-name" class="col-form-label">Description:</label>
						<input type="text" class="form-control" id="edit-productDescription" name="productDescription">
					</div>
					<div class="form-group">
						<label for="product-name" class="col-form-label">Price:</label>
						<input type="number" type="number" step="0.01" class="form-control" id="edit-productPrice"
							name="productPrice">
					</div>
					<div class="form-group">
						<label for="product-priority" class="col-form-label">Product priority:</label>
						<input type="number" class="form-control" id="edit-productPriority" name="productPriority">
					</div>
					<div class="form-group">
						<label for="exampleFormControlSelect1">Category:</label>
						<select class="form-control" id="edit-category" name="categories" multiple="multiple">
							{% for category in categories %}
							<option value="{{ category['category_id'] }}">{{ category['category_name'] }}</option>
							{% endfor %}
						</select>
					</div>
				</form>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
				<button type="submit" class="btn btn-primary" form="edit-form">Confirm</button>
			</div>
		</div>
	</div>
</div>

<!-- Modal for deleting product -->
<div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="deleteModalLabel"
	aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="deleteCategoryModalLabel">Delete product</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<p id="delete-confirm-message"></p>
				<form action="{{ url_for('admin_staff.delete_staff') }}" method="post" id="delete-form">
					<input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
					<input type="hidden" name="product-id" id="delete-product-id">
				</form>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
				<button type="submit" class="btn btn-danger" form="delete-form">Confirm</button>
			</div>
		</div>
	</div>
</div>
{% endblock %}

{% block script %}
<script type="text/javascript">

	$(".custom-file-input").on("change", function () {
		var fileName = $(this).val().split("\\").pop();
		$(this).siblings(".custom-file-label").addClass("selected").html(fileName);
	});

	$('#editModal').on('show.bs.modal', function (event) {
		var button = $(event.relatedTarget)
		var modal = $(this)
		modal.find('#edit-productID').val(button.data('product-id'))
		modal.find('#edit-productName').val(button.data('product-name'))
		modal.find('#edit-productDescription').val(button.data('product-description'))
		modal.find('#edit-productPrice').val(button.data('product-price'))
		modal.find('#edit-productPriority').val(button.data('product-priority'))
	})

	$('#deleteModal').on('show.bs.modal', function (event) {
		var button = $(event.relatedTarget)
		var modal = $(this)
		modal.find('#delete-confirm-message').text('Are you sure to delete the category named ' + button.data('product-name') + ' ?')
		modal.find('#delete-product-id').val(button.data('product-id'))
	})

	$('#updatePictureModal').on('show.bs.modal', function (event) {
		var button = $(event.relatedTarget)
		var modal = $(this)
		modal.find('#update-type').val(button.data('update-type'))
		modal.find('#product-id').val(button.data('product-id'))
	})

	// Set the value of the category select
	var categoryID = '{{ category_id }}'
	if (categoryID !== 'None') {
		$("#categorySelect").val(categoryID);
	} else {
		$("#categorySelect").val('0');
	}

	$(function () {
		// bind change event to select
		$('#categorySelect').on('change', function () {
			var categoryID = $(this).val(); // get selected value
			if (categoryID) { // require a URL
				window.location = '{{ url_for('admin_staff.staff') }}?category_id=' + categoryID; // redirect
			}
			return false;
		});
	});
</script>
{% endblock %}